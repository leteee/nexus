# Example: Configuration References and Shared Defaults
#
# This example demonstrates how to use the @defaults reference system
# to share common configurations across pipeline steps.

# =============================================================================
# Shared Defaults Namespace
# =============================================================================

defaults:
  # Common renderer settings
  renderer_base:
    tolerance_ms: 50.0
    time_offset_ms: 0

  # Speed renderer defaults
  speed_renderer:
    position: [30, 60]
    tolerance_ms: 5000.0
    font_scale: 1.2
    color: [0, 255, 0]  # Green
    thickness: 3

  # Target renderer defaults
  target_renderer:
    tolerance_ms: 50.0
    box_color: [0, 255, 0]  # Green
    box_thickness: 2
    show_panel: true

  # Camera calibration paths (can be referenced in multiple places)
  camera:
    main_calibration: "config/camera_calibration.yaml"

# =============================================================================
# Pipeline Configuration
# =============================================================================

pipeline:
  # Step 1: Split video to frames
  - plugin: "Video Splitter"
    config:
      video_path: "input/video.mp4"
      output_dir: "temp/frames"
      frame_pattern: "frame_{:06d}.png"

  # Step 2: Render data on frames with shared config
  - plugin: "Data Renderer"
    config:
      frames_dir: "temp/frames"
      output_dir: "temp/rendered_frames"
      frame_pattern: "frame_{:06d}.png"
      timestamps_path: "input/vehicle_timeline.csv"
      show_frame_info: true

      renderers:
        # Example 1: Extend and override
        - name: "speed"
          kwargs:
            _extends: "@defaults.speed_renderer"  # Inherit all defaults
            data_path: "input/speed.jsonl"        # Add data_path
            color: [255, 0, 0]                    # Override color to red

        # Example 2: Extend with nested reference
        - name: "target"
          kwargs:
            _extends: "@defaults.target_renderer"              # Inherit target defaults
            data_path: "input/adb_targets.jsonl"
            calibration_path: "@defaults.camera.main_calibration"  # Reference nested value

  # Step 3: Compose video
  - plugin: "Video Composer"
    config:
      frames_dir: "temp/rendered_frames"
      output_path: "output/final_video.mp4"
      fps: 30.0
      frame_pattern: "frame_{:06d}.png"
      codec: "mp4v"

# =============================================================================
# Benefits of Using Defaults
# =============================================================================
#
# 1. DRY (Don't Repeat Yourself)
#    - Define common settings once in 'defaults'
#    - Reference them multiple times
#
# 2. Easy Maintenance
#    - Change defaults in one place
#    - All references automatically updated
#
# 3. Flexibility
#    - Inherit base configuration with _extends
#    - Override specific fields as needed
#
# 4. Type Safety
#    - References validated at runtime
#    - Clear error messages if reference not found
#
# =============================================================================
# Reference Syntax
# =============================================================================
#
# Direct Reference:
#   value: "@defaults.path.to.config"
#   - Replaces entire value with referenced config
#
# Extend and Override:
#   config:
#     _extends: "@defaults.base_config"
#     field1: value1  # Add new field
#     field2: value2  # Override base field
#
# Nested References:
#   Both modes support nested references:
#   "@defaults.camera.main.calibration_file"
#
